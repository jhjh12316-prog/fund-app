<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>基金实时估值</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  background:#0f1116;
  color:#fff;
  font-family:-apple-system;
  padding:20px;
}
.card {
  background:#1a1d25;
  border-radius:12px;
  padding:16px;
  margin-bottom:16px;
}
input,button {
  padding:10px;
  border-radius:8px;
  border:none;
}
button {
  background:#5b6cff;
  color:#fff;
}
.item {
  padding:10px 0;
  border-bottom:1px solid #2a2d36;
}
.red { color:#ff4d4f }
.green { color:#2ecc71 }
</style>
</head>

<body>

<div class="card">
  <h2>添加基金</h2>
  <input id="code" placeholder="基金代码 如 161725">
  <button id="add">添加</button>
</div>

<div class="card">
  <h2>我的自选</h2>
  <div id="list"></div>
</div>

<script>
let funds = JSON.parse(localStorage.getItem("funds") || "[]");
const list = document.getElementById("list");

function save() {
  localStorage.setItem("funds", JSON.stringify(funds));
}

function fetchFund(code, cb) {
  const script = document.createElement("script");
  const callback = "cb_" + Math.random().toString(36).slice(2);
  window[callback] = function(data) {
    cb(data);
    delete window[callback];
    script.remove();
  };
  script.src =
    `https://fundgz.1234567.com.cn/js/${code}.js?rt=${Date.now()}&callback=${callback}`;
  document.body.appendChild(script);
}

function render() {
  list.innerHTML = "";
  funds.forEach(code => {
    fetchFund(code, data => {
      if (!data || !data.fundcode) return;
      const rate = parseFloat(data.gszzl);
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <strong>${data.name}</strong> (${code})<br>
        估值：${data.gsz}　
        <span class="${rate >= 0 ? 'red' : 'green'}">
          ${rate >= 0 ? '+' : ''}${rate}%
        </span>
        <br>
        时间：${data.gstime}
      `;
      list.appendChild(div);
    });
  });
}

document.getElementById("add").onclick = () => {
  const code = document.getElementById("code").value.trim();
  if (!/^\d{6}$/.test(code)) {
    alert("基金代码必须是 6 位数字");
    return;
  }
  if (!funds.includes(code)) {
    funds.push(code);
    save();
    render();
  }
};

render();
setInterval(render, 60000); // 每分钟刷新
</script>

</body>
</html>
